/**
 * Copyright (c) 2016 - 2020 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';

const INTERFACES = require('../../enums').INTERFACES;
const Semver = require('semver');

module.exports = function () {
    // Do nothing on module loading event - instrumentation happens through enable
};

module.exports.enable = function (ecoSystemInterface) {

    const instrumentation = ecoSystemInterface.getInterface(INTERFACES.INSTRUMENTATION);
    instrumentation.setWrapCallback('fastify', (mod, identity, request) => {

        if (Semver.satisfies(identity.version, '3.x') && request === 'fastify') { // We only hook the export of the fastify@3 package
            return require('./fastify_versions/fastify3')(mod, ecoSystemInterface);
        }
        return mod; // This is a wrapCallback, we must return
    });
};


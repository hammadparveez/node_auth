/**
 * Copyright (c) 2016 - 2021 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const EcosystemInterface = require('../ecosystem/ecosystemInterface');
const Engine = require('./index');

let ns;
// cycle condition somewhere
const getNS = function () {

    if (ns === undefined) {
        ns = require('../instrumentation/hooks/util').getNS();
    }
    return ns;
};

const NAME = 'engine';
const engineInterface = module.exports = new EcosystemInterface(NAME);

engineInterface.subscribe = Engine.subscribe;
engineInterface.createSpanFromRoot = Engine.createSpanFromRoot;
engineInterface.getNeededFieldSet = Engine.getNeededFieldSet;

engineInterface.resolveAddress = function (address) {

    const topSpan = getNS().get('topSpan');
    // $lab:coverage:off$
    if (topSpan !== undefined){ // $lab:coverage:on$
        return topSpan.resolve(address);
    }
};
